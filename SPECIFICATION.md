# 料理管理システム 詳細仕様書

## 📋 概要

家族の人数と好みに合わせて指定された日数分の夕飯メニューを提案し、買い物リストと在庫管理ができる料理管理システムです。

## 🎯 主要機能

### 1. ユーザー認証
- **アカウント作成**: メールアドレスとパスワードでアカウント作成
- **ログイン**: 既存アカウントでのログイン
- **ログアウト**: セッション終了
- **認証状態管理**: Supabase Authを使用

### 2. 基本設定（SettingsPage）
#### 家族構成設定
- **家族人数**: 自動計算（家族構成の人数に基づく）
- **家族構成詳細**:
  - 名前（任意）
  - 生年月日（年・月・日の選択式）
  - 性別（男性・女性）
  - 食べる量（1-5段階のスライダー）
  - 年齢の自動計算・表示

#### ヘルスモード設定
- **通常モード**: バランスの良い食事
- **ダイエットモード**: 低カロリー・ヘルシー
- **筋トレモード**: 高タンパク・筋肉増強

#### 料理評価別出現頻度設定
- **S級料理**: 設定日数に1回（デフォルト: 2日に1回）
- **A級料理**: 設定日数に1回（デフォルト: 3日に1回）
- **B級料理**: 設定日数に1回（デフォルト: 7日に1回）
- **C級料理**: 献立に含まれません（自動除外）

#### 好みの設定
- **自由記述**: 辛い料理、野菜多め、アレルギー情報など

### 3. メニュー生成（HomePage）
#### 期間設定
- **開始日・終了日**: カレンダー選択
- **日数表示**: 自動計算

#### 料理種類設定
- **和食・洋食・中華**: 各料理の日数を指定
- **合計日数チェック**: 期間日数と一致する必要あり

#### 調理時間制約
- **忙しい日選択**: 期間内の日付から複数選択可能
- **最大調理時間**: 10-30分から選択
- **短時間メニュー**: 忙しい日には調理時間の短いメニューを提案

#### メニュー生成条件
- 家族構成に基づく分量調整
- ヘルスモードに応じた栄養バランス
- 過去の評価に基づく料理選択頻度
- ユーザーの好み反映

### 4. メニュー管理（MenuPage）
#### メニュー表示
- **日付別表示**: 曜日・日付ごとにカード表示
- **献立構成**:
  - 主菜（必須）
  - 副菜（80%の確率で追加）
  - 汁物（60%の確率で追加）
- **調理情報**:
  - 合計調理時間
  - 難易度（星1-5）
  - 必要食材リスト

#### メニュー操作
- **詳細表示**: 展開・折りたたみ機能
- **お気に入り追加**: ハートボタンでお気に入り登録
- **メニュー入れ替え**: ドラッグ&ドロップで日付間の献立交換
- **個別メニュー変更**: 特定の日のメニューを再生成
- **買い物リスト生成**: 全メニューから必要食材を抽出

### 5. 買い物管理
#### 買い物リスト（ShoppingListPage）
- **カテゴリ別表示**: 野菜・肉魚・調味料・その他
- **必要量計算**: 在庫を考慮した購入必要量
- **料理別内訳**: どの料理にどれだけ必要かを表示
- **チェック機能**: 購入済みアイテムのチェック
- **進捗表示**: 完了率をプログレスバーで表示

#### モバイル買い物（MobileShoppingPage）
- **大きなボタン**: タッチしやすいUI
- **カテゴリ別色分け**: 視認性の向上
- **選択状態表示**: 選択済みアイテムの明確な表示
- **一括確定**: 選択したアイテムを一括で購入完了
- **在庫自動更新**: 購入完了時に在庫に自動反映

### 6. 在庫管理（InventoryPage）
#### 在庫表示
- **期限管理**:
  - 期限切れ（赤色）
  - 期限間近（黄色、3日以内）
  - 新鮮（緑色）
- **ソート機能**: 期限順での自動ソート
- **検索・フィルター**: 食材名検索、カテゴリフィルター

#### 在庫操作
- **追加**: フローティングボタンから新規追加
- **編集**: 既存アイテムの情報変更
- **削除**: 不要なアイテムの削除
- **自動更新**: 買い物完了時の自動在庫追加

### 7. お気に入り・評価管理（FavoritesPage）
#### タブ構成
- **お気に入り**: 手動で追加したお気に入りレシピ
- **S級**: 18-20点の最高評価料理
- **A級**: 14-17点の高評価料理
- **B級**: 7-13点の普通評価料理
- **C級**: 6点以下の低評価料理

#### 評価システム
- **4項目評価**（各1-5星）:
  - おいしかった
  - 調理時間の満足度
  - 難易度の満足度
  - またつくりたい
- **総合評価**: 4項目の合計点でS/A/B/C判定
- **評価日表示**: カード右上に評価日を表示

### 8. カレンダー機能（CalendarPage）
#### カレンダー表示
- **月表示**: 標準的なカレンダーレイアウト
- **メニュー表示**: 各日にその日の献立を表示
- **完了状態**: 調理完了した日をマーク表示
- **統計情報**: 総メニュー数、総料理数、月間メニュー数など

#### 調理完了機能
- **完了マーク**: その日の料理を完了としてマーク
- **評価入力**: 完了時に料理の評価を入力
- **在庫消費**: 完了時に使用した食材を在庫から自動減算
- **完了リセット**: 誤って完了した場合のリセット機能

### 9. 料理評価（RecipeRatingModal）
#### 評価入力
- **初期値**: 全項目☆1で初期化
- **4項目評価**: 各項目1-5星で評価
- **総合評価表示**: リアルタイムでS/A/B/C判定を表示
- **上書き保存**: 同じ料理の既存評価を上書き

#### 評価反映
- **頻度制御**: 評価に基づく今後の出現頻度調整
- **C級除外**: C評価の料理は今後の献立から自動除外
- **リアルタイム更新**: 評価後すぐにお気に入りページに反映

## 🗄️ データベース構造

### user_profiles
- 家族構成、好み、ヘルスモード、評価頻度設定

### user_inventory
- 在庫アイテム、数量、単位、カテゴリ、期限

### user_menu_plans
- 生成されたメニュープラン、レシピ情報

### user_shopping_lists
- 買い物リスト、必要量、在庫量、チェック状態

### user_favorites
- お気に入りレシピ情報

### user_purchased_items
- 購入履歴、購入日、数量

### user_completed_days
- 調理完了日、使用レシピ

### user_recipe_ratings
- 料理評価、4項目の点数、評価日

## 🎨 UI/UX設計

### レスポンシブデザイン
- **モバイル**: 下部ナビゲーション
- **デスクトップ**: 左サイドバーナビゲーション

### カラーシステム
- **プライマリ**: オレンジ系（料理・食材をイメージ）
- **カテゴリ別色分け**:
  - 野菜: 緑系
  - 肉・魚: 赤系
  - 調味料: オレンジ系
  - その他: グレー系

### インタラクション
- **ドラッグ&ドロップ**: メニューの入れ替え
- **展開・折りたたみ**: 詳細情報の表示制御
- **プログレスバー**: 進捗状況の視覚化
- **フローティングボタン**: 主要アクションへの素早いアクセス

## 🔧 技術仕様

### フロントエンド
- **React 18**: UIライブラリ
- **TypeScript**: 型安全性
- **Tailwind CSS**: スタイリング
- **Lucide React**: アイコン

### バックエンド
- **Supabase**: データベース・認証
- **PostgreSQL**: リレーショナルデータベース
- **Row Level Security**: データセキュリティ

### 開発環境
- **Vite**: ビルドツール
- **ESLint**: コード品質管理

## 🚀 主要な処理フロー

### 1. メニュー生成フロー
1. 家族構成・好み・期間を設定
2. 料理データベースから条件に合うレシピを選択
3. 評価履歴に基づく頻度制御を適用
4. 分量を家族構成に合わせて調整
5. 日付・曜日を割り当ててメニュープラン生成

### 2. 買い物リスト生成フロー
1. メニュープランから全必要食材を抽出
2. 同じ食材をまとめて合計必要量を計算
3. 現在の在庫量と照合
4. 不足分を買い物リストとして生成
5. カテゴリ別にソートして表示

### 3. 調理完了フロー
1. カレンダーから完了日を選択
2. その日のレシピ一覧を表示
3. 各レシピの評価を入力（4項目×1-5星）
4. 評価を保存し、S/A/B/C判定を実行
5. 使用食材を在庫から自動減算
6. 完了状態をカレンダーに反映

## 📱 画面構成

### ナビゲーション
- ホーム
- 基本設定
- お気に入り
- メニュー
- 買い物
- 買い物専用（モバイル特化）
- 在庫
- カレンダー

### 認証
- ログイン・サインアップモーダル
- ユーザーメニュー

## 🔒 セキュリティ

### 認証・認可
- Supabase Authによるセキュアな認証
- Row Level Security（RLS）によるデータ保護
- ユーザー固有データの完全分離

### データ保護
- 個人情報の暗号化
- セッション管理
- CSRF対策

## 🎯 今後の拡張可能性

### 機能拡張
- 栄養価計算・表示
- レシピの詳細手順表示
- 食材の価格管理
- 家族間でのメニュー共有
- 外部レシピサイトとの連携

### UI/UX改善
- ダークモード対応
- アクセシビリティ向上
- PWA対応
- オフライン機能

### データ分析
- 食事パターン分析
- 栄養バランス分析
- 食費分析
- 好み学習機能

---

*最終更新: 2025年1月*