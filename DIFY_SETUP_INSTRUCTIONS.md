# Dify チャットボット連携設定ガイド

## 📋 セットアップ手順

### 1. Difyでチャットボットを作成

1. [Dify](https://dify.ai/)にログインまたは新規登録
2. 新しいアプリを作成（「チャットボット」タイプを選択）
3. システムプロンプトに以下の内容を設定：

```
あなたは bolt.new 上で動作するチャットボットです。  
このチャットボットは、ユーザーから「献立作成リクエスト」を受け取り、  
**必ず定義されたJSON形式で出力** してください。

[以下、DIFY_INTEGRATION_GUIDE.mdに記載されているシステムプロンプト全文をコピー]
```

### 2. APIキーの取得

1. Difyアプリの「APIアクセス」設定に移動
2. 「APIキーを作成」をクリック
3. 生成されたAPIキー（`app-`で始まる文字列）をコピー
4. APIエンドポイントURL（例：`https://api.dify.ai/v1`）を確認

### 3. 料理管理システムでの設定

1. アプリケーションを起動（`http://localhost:5173`）
2. ホーム画面の「AIチャットボット連携」セクションで「設定」をクリック
3. 以下を入力：
   - **APIエンドポイント**: Difyから取得したURL（例：`https://api.dify.ai/v1`）
   - **APIキー**: Difyから取得したAPIキー（`app-xxxxx`形式）
4. 「接続テスト」をクリックして接続を確認
5. 「保存」をクリック

### 4. メニュー生成

1. ホーム画面で「Difyチャットボットを使用してメニュー生成」にチェック
2. 期間と条件を設定
3. 「AIメニューを生成」ボタンをクリック

## 🚀 動作確認

### 正常に動作している場合
- 「Dify設定済み」と緑色で表示される
- メニュー生成時にAIが高度なメニューを提案
- 在庫を考慮した最適なメニューが生成される

### トラブルシューティング

#### 接続テストが失敗する場合
1. APIエンドポイントURLが正しいか確認（末尾に`/`を含めない）
2. APIキーが正しくコピーされているか確認
3. Difyアプリが公開されているか確認

#### メニュー生成が失敗する場合
1. ブラウザの開発者ツール（F12）でコンソールログを確認
2. エラーメッセージに応じて対処：
   - タイムアウト：ネットワーク接続を確認
   - 認証エラー：APIキーを再確認
   - フォーマットエラー：Difyのシステムプロンプトを確認

## 📝 注意事項

- APIキーは安全に管理してください（他人と共有しない）
- 無料プランの場合、API呼び出し回数に制限があります
- Dify設定なしでもローカル生成機能で利用可能です

## 🎯 Dify連携のメリット

1. **高度なメニュー提案**: AIが家族の好みを理解して最適なメニューを生成
2. **在庫活用**: 期限が近い食材を優先的に使用
3. **栄養バランス**: ヘルスモードに応じた健康的なメニュー
4. **創造性**: より多様で個性的な料理の提案

## 📞 サポート

問題が解決しない場合は、以下を確認してください：
- Difyのドキュメント: https://docs.dify.ai/
- このアプリケーションのログ（ブラウザコンソール）